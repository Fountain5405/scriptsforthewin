<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RandomX v2 - What It Does &amp; Why</title>
<style>
  :root {
   --accent: #f7931a;
   --dark: #1a1a2e;
   --mid: #16213e;
   --light: #e8e8e8;
   --green: #4ecca3;
   --red: #e84545;
   --blue: #3498db;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
    background: var(--dark);
    color: var(--light);
    line-height: 1.7;
  }
  .container { max-width: 960px; margin: 0 auto; padding: 2rem 1.5rem; }

  /* Hero */
  .hero {
    text-align: center;
    padding: 4rem 1rem 3rem;
    background: linear-gradient(135deg, var(--dark), var(--mid));
    border-bottom: 3px solid var(--accent);
  }
  .hero h1 { font-size: 2.8rem; color: var(--accent); margin-bottom: 0.5rem; }
  .hero p { font-size: 1.2rem; color: #aaa; max-width: 600px; margin: 0 auto; }

  /* Sections */
  section { padding: 3rem 0; }
  h2 {
    font-size: 1.8rem;
    color: var(--accent);
    margin-bottom: 1.2rem;
    border-left: 4px solid var(--accent);
    padding-left: 0.8rem;
  }
  p, li { font-size: 1.05rem; margin-bottom: 0.8rem; }
  ul { padding-left: 1.5rem; }

  /* Cards */
  .card-row {
    display: flex;
    gap: 1.5rem;
    margin: 1.5rem 0;
    flex-wrap: wrap;
  }
  .card {
    flex: 1;
    min-width: 260px;
    background: var(--mid);
    border-radius: 12px;
    padding: 1.5rem;
    border: 1px solid #2a2a4a;
  }
  .card h3 { color: var(--green); margin-bottom: 0.6rem; font-size: 1.15rem; }

  /* Bar chart */
  .bar-chart { margin: 1.5rem 0; }
  .bar-row {
    display: flex;
    align-items: center;
    margin-bottom: 0.7rem;
  }
  .bar-label {
    width: 130px;
    font-weight: 600;
    text-align: right;
    padding-right: 1rem;
    font-size: 0.95rem;
  }
  .bar-track {
    flex: 1;
    background: #2a2a4a;
    border-radius: 8px;
    height: 36px;
    position: relative;
    overflow: hidden;
  }
  .bar-fill {
    height: 100%;
    border-radius: 8px;
    display: flex;
    align-items: center;
    padding-left: 12px;
    font-weight: 700;
    font-size: 0.9rem;
    transition: width 0.6s ease;
  }
  .bar-v1 { background: var(--blue); width: 67%; }
  .bar-v2 { background: var(--green); width: 100%; }

  /* Diagram */
  .diagram {
    background: var(--mid);
    border-radius: 12px;
    padding: 2rem;
    margin: 1.5rem 0;
    border: 1px solid #2a2a4a;
    text-align: center;
  }
  .flow {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    flex-wrap: wrap;
    margin: 1rem 0;
  }
  .flow-box {
    background: var(--dark);
    border: 2px solid var(--accent);
    border-radius: 10px;
    padding: 0.8rem 1.2rem;
    font-size: 0.95rem;
    font-weight: 600;
  }
  .flow-arrow { font-size: 1.5rem; color: var(--accent); }

  /* Comparison table */
  table {
    width: 100%;
    border-collapse: collapse;
    margin: 1.5rem 0;
    background: var(--mid);
    border-radius: 12px;
    overflow: hidden;
  }
  th, td { padding: 0.9rem 1.2rem; text-align: left; }
  th { background: #0f3460; color: var(--accent); font-size: 0.95rem; }
  td { border-top: 1px solid #2a2a4a; }
  tr:hover td { background: rgba(247, 147, 26, 0.05); }

  /* Icon grid */
  .icon-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.2rem;
    margin: 1.5rem 0;
  }
  .icon-item {
    background: var(--mid);
    border-radius: 12px;
    padding: 1.5rem;
    text-align: center;
    border: 1px solid #2a2a4a;
  }
  .icon-item .emoji { font-size: 2.5rem; margin-bottom: 0.5rem; }
  .icon-item h4 { color: var(--green); margin-bottom: 0.3rem; }

  /* Gauge */
  .gauge-row {
    display: flex;
    gap: 2rem;
    justify-content: center;
    flex-wrap: wrap;
    margin: 1.5rem 0;
  }
  .gauge {
    text-align: center;
    width: 180px;
  }
  .gauge svg { width: 160px; height: 100px; }
  .gauge-label { font-size: 0.95rem; color: #aaa; margin-top: 0.3rem; }
  .gauge-value { font-size: 1.4rem; font-weight: 700; }

  /* Footer */
  footer {
    text-align: center;
    padding: 2rem 0;
    color: #555;
    font-size: 0.85rem;
    border-top: 1px solid #2a2a4a;
  }

  /* Callout */
  .callout {
    background: rgba(247, 147, 26, 0.1);
    border-left: 4px solid var(--accent);
    border-radius: 0 8px 8px 0;
    padding: 1.2rem 1.5rem;
    margin: 1.5rem 0;
  }
  .callout strong { color: var(--accent); }

  /* Responsive */
  @media (max-width: 600px) {
    .hero h1 { font-size: 2rem; }
    .card-row { flex-direction: column; }
  }
</style>
</head>
<body>

<!-- Hero -->
<div class="hero">
  <h1>RandomX v2</h1>
  <p>A stronger, fairer way to secure cryptocurrency - and a benchmark tool to measure it</p>
</div>

<div class="container">

<!-- Section 1: What is RandomX? -->
<section>
  <h2>What is RandomX?</h2>
  <p>
    RandomX is a <strong>proof-of-work algorithm</strong> - a mathematical puzzle that computers solve
    to validate and secure cryptocurrency transactions. Think of it like a combination lock that
    takes real effort to open, ensuring nobody can cheat the system.
  </p>
  <p>
    What makes RandomX special is that it's designed to run best on <strong>everyday CPUs</strong> - the
    same processors in regular desktops and laptops - rather than expensive specialized hardware.
    This keeps mining accessible and decentralized.
  </p>

  <div class="diagram">
    <strong style="color: var(--accent);">How RandomX works (simplified)</strong>
    <div class="flow">
      <div class="flow-box">Transaction Data</div>
      <span class="flow-arrow">&rarr;</span>
      <div class="flow-box">RandomX Puzzle</div>
      <span class="flow-arrow">&rarr;</span>
      <div class="flow-box">CPU Solves It</div>
      <span class="flow-arrow">&rarr;</span>
      <div class="flow-box">Block Confirmed &check;</div>
    </div>
    <p style="color:#888; margin-top:0.8rem; font-size:0.9rem;">
      Each "hash" is one attempt at solving the puzzle. More hashes = more attempts per second.
    </p>
  </div>
</section>

<!-- Section 2: V1 vs V2 -->
<section>
  <h2>What Changed in Version 2?</h2>
  <p>
    RandomX v2 makes the puzzle <strong>50% harder per hash</strong> by increasing the number of
    computational steps from ~4.2 million to ~6.3 million operations. But "harder" here is a
    good thing - it means each solution proves more real work was done.
  </p>

  <table>
    <thead>
      <tr>
        <th>Property</th>
        <th>v1 (Original)</th>
        <th>v2 (New)</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Operations per hash</td>
        <td>~4.2 million</td>
        <td>~6.3 million</td>
      </tr>
      <tr>
        <td>Program size</td>
        <td>256 instructions</td>
        <td>384 instructions</td>
      </tr>
      <tr>
        <td>Work increase</td>
        <td>Baseline</td>
        <td>+50% more work per hash</td>
      </tr>
      <tr>
        <td>Best hardware</td>
        <td>CPUs</td>
        <td>CPUs (even more so)</td>
      </tr>
    </tbody>
  </table>

  <div class="callout">
    <strong>Key insight:</strong> Even though v2 produces fewer hashes per second,
    each hash represents 50% more computational work. The total useful work per second
    can actually be <em>higher</em> with v2 on modern CPUs.
  </div>

  <h3 style="color:var(--green); margin: 1.5rem 0 0.8rem;">Work per Hash - Visual Comparison</h3>
  <div class="bar-chart">
    <div class="bar-row">
      <span class="bar-label">v1</span>
      <div class="bar-track">
        <div class="bar-fill bar-v1">4.2M ops</div>
      </div>
    </div>
    <div class="bar-row">
      <span class="bar-label">v2</span>
      <div class="bar-track">
        <div class="bar-fill bar-v2">6.3M ops</div>
      </div>
    </div>
  </div>
</section>

<!-- Section 3: Why? -->
<section>
  <h2>Why Upgrade to v2?</h2>
  <div class="icon-grid">
    <div class="icon-item">
      <div class="emoji">&#x1F6E1;&#xFE0F;</div>
      <h4>Stronger Security</h4>
      <p>More operations per hash means the puzzle is harder to shortcut with specialized chips (ASICs/FPGAs).</p>
    </div>
    <div class="icon-item">
      <div class="emoji">&#x2696;&#xFE0F;</div>
      <h4>Fairer Mining</h4>
      <p>Keeps everyday CPUs competitive, so regular people can participate - not just large mining farms.</p>
    </div>
    <div class="icon-item">
      <div class="emoji">&#x26A1;</div>
      <h4>Better Efficiency</h4>
      <p>Modern CPUs can do more useful work per watt of energy with the v2 algorithm.</p>
    </div>
    <div class="icon-item">
      <div class="emoji">&#x1F50D;</div>
      <h4>Proven by Testing</h4>
      <p>The benchmark suite rigorously tests performance, stability, and power consumption before adoption.</p>
    </div>
  </div>
</section>

<!-- Section 4: The Benchmark Tool -->
<section>
  <h2>What the Benchmark Tool Does</h2>
  <p>
    This project includes an automated <a href="https://github.com/Fountain5405/scriptsforthewin/blob/main/randomx_benchmark_full.sh" style="color:var(--accent);">benchmarking script</a> that runs both v1 and v2 side by side
    on your hardware and compares the results. Here's what it measures:
  </p>

  <div class="diagram">
    <strong style="color: var(--accent);">Benchmark Pipeline</strong>
    <div class="flow">
      <div class="flow-box">Detect CPU</div>
      <span class="flow-arrow">&rarr;</span>
      <div class="flow-box">Optimize Settings</div>
      <span class="flow-arrow">&rarr;</span>
      <div class="flow-box">Run v1 &amp; v2</div>
      <span class="flow-arrow">&rarr;</span>
      <div class="flow-box">Measure &amp; Compare</div>
    </div>
  </div>

  <div class="card-row">
    <div class="card">
      <h3>Speed</h3>
      <p>How many hashes per second each version achieves - the raw throughput of the algorithm.</p>
    </div>
    <div class="card">
      <h3>Power Draw</h3>
      <p>Watts consumed during the test, measured directly from CPU power sensors (RAPL).</p>
    </div>
    <div class="card">
      <h3>Efficiency</h3>
      <p>RandomX instructions per joule of energy - the most important metric for real-world viability.</p>
    </div>
  </div>
  <div class="card-row">
    <div class="card">
      <h3>Stability</h3>
      <p>Tracks crashes and errors over hundreds of runs to ensure the algorithm is rock-solid.</p>
    </div>
    <div class="card">
      <h3>Total Work</h3>
      <p>Combines hashrate with operations-per-hash to show real computational output per second.</p>
    </div>
    <div class="card">
      <h3>Smart Tuning</h3>
      <p>Automatically detects your CPU type and applies optimal settings for AMD Ryzen, EPYC, and Intel processors.</p>
    </div>
  </div>
</section>

<!-- Section 5: Gauges -->
<section>
  <h2>What v2 Aims to Achieve</h2>
  <p>The ideal outcome of adopting RandomX v2:</p>
  <div class="gauge-row">
    <div class="gauge">
      <svg viewBox="0 0 160 100">
        <path d="M20 90 A60 60 0 0 1 140 90" fill="none" stroke="#2a2a4a" stroke-width="14" stroke-linecap="round"/>
        <path d="M20 90 A60 60 0 0 1 140 90" fill="none" stroke="var(--green)" stroke-width="14" stroke-linecap="round" stroke-dasharray="188" stroke-dashoffset="0"/>
        <text x="80" y="80" text-anchor="middle" fill="var(--green)" font-size="22" font-weight="700">+50%</text>
      </svg>
      <div class="gauge-label">Work per Hash</div>
    </div>
    <div class="gauge">
      <svg viewBox="0 0 160 100">
        <path d="M20 90 A60 60 0 0 1 140 90" fill="none" stroke="#2a2a4a" stroke-width="14" stroke-linecap="round"/>
        <path d="M20 90 A60 60 0 0 1 140 90" fill="none" stroke="var(--accent)" stroke-width="14" stroke-linecap="round" stroke-dasharray="188" stroke-dashoffset="30"/>
        <text x="80" y="80" text-anchor="middle" fill="var(--accent)" font-size="22" font-weight="700">High</text>
      </svg>
      <div class="gauge-label">ASIC Resistance</div>
    </div>
    <div class="gauge">
      <svg viewBox="0 0 160 100">
        <path d="M20 90 A60 60 0 0 1 140 90" fill="none" stroke="#2a2a4a" stroke-width="14" stroke-linecap="round"/>
        <path d="M20 90 A60 60 0 0 1 140 90" fill="none" stroke="var(--blue)" stroke-width="14" stroke-linecap="round" stroke-dasharray="188" stroke-dashoffset="15"/>
        <text x="80" y="80" text-anchor="middle" fill="var(--blue)" font-size="22" font-weight="700">Better</text>
      </svg>
      <div class="gauge-label">Energy Efficiency</div>
    </div>
  </div>
</section>

<!-- Section 6: Analogy -->
<section>
  <h2>An Everyday Analogy</h2>
  <div class="diagram" style="text-align:left;">
    <p>
      Imagine a <strong>spelling bee</strong> where contestants prove their skill by spelling words correctly.
    </p>
    <ul style="margin: 1rem 0 1rem 1.5rem;">
      <li><strong>v1</strong> is like spelling 4-letter words. Fast, but someone could build a machine to buzz in first.</li>
      <li><strong>v2</strong> is like spelling 6-letter words. Slightly slower per word, but it tests <em>real ability</em> more deeply - making it much harder to cheat with a gadget.</li>
    </ul>
    <p>
      The benchmark tool is the <strong>stopwatch and scorecard</strong> - it times each contestant,
      tracks their accuracy, and figures out who is the most efficient speller.
    </p>
  </div>
</section>

<!-- Section 7: In a Nutshell -->
<section>
  <h2>In a Nutshell</h2>
  <div class="callout">
    <strong>RandomX v2</strong> makes cryptocurrency mining puzzles harder to cheat on, fairer for
    regular computer owners, and more energy-efficient on modern hardware. The <a href="https://github.com/Fountain5405/scriptsforthewin/blob/main/randomx_benchmark_full.sh" style="color:var(--accent);">benchmark tool</a>
    in this project proves these benefits with real measurements: speed, power draw, and
    stability, across hundreds of test runs on your own CPU.
  </div>
</section>

<!-- ============================================================ -->
<!-- DEEP DIVE - Technical Details                                -->
<!-- ============================================================ -->

<section>
  <h2 style="margin-top:2rem;">Deep Dive: The v1 Idle-Cycle Problem</h2>
  <p>
    To understand why v2 exists, you need to understand a fundamental tension inside your CPU:
    <strong>computation is fast, but fetching data from memory is slow.</strong>
  </p>
  <p>
    RandomX's main loop works by repeatedly executing a small random program and then reading
    a chunk of data (64 bytes) from a large <em>Dataset</em> stored in RAM. Each program iteration
    is deliberately tuned to take about <strong>50&ndash;55 nanoseconds</strong> - roughly the same
    time it takes for DRAM to deliver data. The idea is that the CPU computes while the next
    piece of data is being fetched in the background (prefetched), so neither the CPU nor the
    memory bus sits idle.
  </p>
  <p>
    The problem? <strong>While CPU cores got faster over the years, RAM latency stayed basically
    the same.</strong> CPUs have advanced roughly 1.5x since RandomX was designed in 2019, but
    DRAM still takes ~50&ndash;55 ns to respond. Modern processors like AMD Zen 5 finish the
    v1 program well before the data arrives - and then sit idle, burning power while waiting.
  </p>

  <div class="diagram">
    <strong style="color: var(--accent);">v1: The Idle Gap</strong>
    <div style="margin:1.5rem auto; max-width:700px; text-align:left;">
      <div style="display:flex; align-items:center; gap:0.5rem; margin-bottom:0.5rem;">
        <span style="width:90px; text-align:right; font-size:0.85rem; color:#aaa;">CPU</span>
        <div style="flex:1; display:flex; height:32px; border-radius:6px; overflow:hidden;">
          <div style="width:50%; background:var(--blue); display:flex; align-items:center; justify-content:center; font-size:0.8rem; font-weight:700;">Compute (256 instructions)</div>
          <div style="width:15%; background:var(--blue); display:flex; align-items:center; justify-content:center; font-size:0.75rem; font-weight:600;">XOR mix</div>
          <div style="width:35%; background:#e84545; display:flex; align-items:center; justify-content:center; font-size:0.75rem; font-weight:700; color:#fff;">Idle - waiting for data</div>
        </div>
      </div>
      <div style="display:flex; align-items:center; gap:0.5rem;">
        <span style="width:90px; text-align:right; font-size:0.85rem; color:#aaa;">Memory</span>
        <div style="flex:1; display:flex; height:32px; border-radius:6px; overflow:hidden;">
          <div style="width:15%; background:transparent;"></div>
          <div style="width:55%; background:var(--accent); display:flex; align-items:center; justify-content:center; font-size:0.8rem; font-weight:700; color:#1a1a2e;">Fetching dataset (50–100 ns)</div>
          <div style="width:30%; background:transparent;"></div>
        </div>
      </div>
    </div>
    <p style="color:#e84545; font-size:0.9rem; margin-top:0.5rem;">
      In v1, the CPU finishes its 256-instruction program and the simple XOR register mix
      <strong>before</strong> the memory fetch completes. It stalls, doing nothing, wasting energy.
    </p>
  </div>

  <p>
    This idle window is the core inefficiency of v1. The CPU has finished all its work
    but the next piece of dataset hasn't arrived yet. Those wasted cycles still consume
    power - your CPU is burning electricity while doing zero useful work.
  </p>
</section>

<section>
  <h2>How v2 Fills the Gap</h2>
  <p>
    RandomX v2 makes two key changes to eliminate the idle window:
  </p>

  <div class="card-row">
    <div class="card">
      <h3>1. Bigger Programs (256 &rarr; 384 instructions)</h3>
      <p>
        CPUs have gotten roughly 1.5x faster since RandomX was designed in 2019, but RAM latency
        stayed at ~50-55 ns. So v2 increases the program to <strong>384 instructions</strong>
        (1.5x), matching the CPU-to-memory speed ratio again and filling the gap with real computation.
      </p>
    </div>
    <div class="card">
      <h3>2. AES Register Mixing (XOR &rarr; 16 AES rounds)</h3>
      <p>
        In v1, the F and E registers were mixed with a simple XOR - nearly instant.
        In v2, they're mixed with <strong>16 AES encryption rounds</strong>. This uses the
        CPU's dedicated AES hardware during what was previously dead time, and also
        improves data entropy before scratchpad writes.
      </p>
    </div>
  </div>

  <div class="diagram">
    <strong style="color: var(--accent);">v2: The Gap is Gone</strong>
    <div style="margin:1.5rem auto; max-width:700px; text-align:left;">
      <div style="display:flex; align-items:center; gap:0.5rem; margin-bottom:0.5rem;">
        <span style="width:90px; text-align:right; font-size:0.85rem; color:#aaa;">CPU</span>
        <div style="flex:1; display:flex; height:32px; border-radius:6px; overflow:hidden;">
          <div style="width:62%; background:var(--blue); display:flex; align-items:center; justify-content:center; font-size:0.8rem; font-weight:700;">Compute (384 instructions)</div>
          <div style="width:38%; background:var(--green); display:flex; align-items:center; justify-content:center; font-size:0.8rem; font-weight:700; color:#1a1a2e;">16&times; AES mixing</div>
        </div>
      </div>
      <div style="display:flex; align-items:center; gap:0.5rem;">
        <span style="width:90px; text-align:right; font-size:0.85rem; color:#aaa;">Memory</span>
        <div style="flex:1; display:flex; height:32px; border-radius:6px; overflow:hidden;">
          <div style="width:8%; background:transparent;"></div>
          <div style="width:55%; background:var(--accent); display:flex; align-items:center; justify-content:center; font-size:0.8rem; font-weight:700; color:#1a1a2e;">Fetching dataset (50–100 ns)</div>
          <div style="width:37%; background:transparent;"></div>
        </div>
      </div>
    </div>
    <p style="color:var(--green); font-size:0.9rem; margin-top:0.5rem;">
      The CPU is now busy the <strong>entire time</strong> data is being fetched.
      No wasted cycles. No wasted energy.
    </p>
  </div>

  <div class="callout">
    <strong>The AES trick is especially clever:</strong> it doesn't just fill idle time - it also
    strengthens ASIC resistance. In v1, a custom chip could skip AES in the main loop because it
    was only used for scratchpad initialization. In v2, AES is woven directly into the VM's core
    register mixing, so any hardware implementation <em>must</em> include a full AES engine inside
    the RandomX virtual machine itself.
  </div>
</section>

<section>
  <h2>The Prefetch Distance Change</h2>
  <p>
    The second major optimization is about <strong>how far ahead</strong> the CPU looks when
    pre-loading data from RAM.
  </p>

  <div class="card-row">
    <div class="card">
      <h3>v1: Prefetch 1 Iteration Ahead</h3>
      <p>
        While running iteration N, the CPU requests the data for iteration N+1.
        On faster modern CPUs, this isn't enough lead time - the data may not arrive
        before it's needed, causing a stall.
      </p>
    </div>
    <div class="card">
      <h3>v2: Prefetch 2 Iterations Ahead</h3>
      <p>
        While running iteration N, the CPU requests data for iteration N+2.
        This gives DRAM twice as long to deliver, virtually guaranteeing the data
        is ready when needed - even on the fastest modern processors.
      </p>
    </div>
  </div>

  <div class="diagram">
    <strong style="color: var(--accent);">Prefetch Timeline</strong>
    <div style="margin:1.5rem auto; max-width:720px; text-align:left; font-size:0.85rem;">
      <p style="color:var(--blue); font-weight:700; margin-bottom:0.3rem;">v1 (1 iteration lookahead):</p>
      <div style="display:flex; gap:2px; margin-bottom:1rem;">
        <div style="flex:1; background:var(--blue); border-radius:4px; padding:6px; text-align:center; font-weight:600;">Iter N<br><span style="font-size:0.75rem; color:#ccc;">prefetch N+1</span></div>
        <div style="flex:1; background:var(--blue); border-radius:4px; padding:6px; text-align:center; font-weight:600;">Iter N+1<br><span style="font-size:0.75rem; color:#e84545;">data may not be ready!</span></div>
        <div style="flex:1; background:var(--blue); border-radius:4px; padding:6px; text-align:center; font-weight:600;">Iter N+2</div>
      </div>
      <p style="color:var(--green); font-weight:700; margin-bottom:0.3rem;">v2 (2 iteration lookahead):</p>
      <div style="display:flex; gap:2px;">
        <div style="flex:1; background:var(--green); border-radius:4px; padding:6px; text-align:center; font-weight:600; color:#1a1a2e;">Iter N<br><span style="font-size:0.75rem;">prefetch N+2</span></div>
        <div style="flex:1; background:var(--green); border-radius:4px; padding:6px; text-align:center; font-weight:600; color:#1a1a2e;">Iter N+1<br><span style="font-size:0.75rem;">prefetch N+3</span></div>
        <div style="flex:1; background:var(--green); border-radius:4px; padding:6px; text-align:center; font-weight:600; color:#1a1a2e;">Iter N+2<br><span style="font-size:0.75rem;">data ready &check;</span></div>
      </div>
    </div>
    <p style="color:#aaa; font-size:0.85rem; margin-top:0.8rem;">
      By requesting data two iterations in advance, the memory system has twice as long
      to deliver - eliminating stalls on fast modern CPUs.
    </p>
  </div>
</section>

<section>
  <h2>The CFROUND Optimization</h2>
  <p>
    A third, more subtle change targets floating-point performance. The <code>CFROUND</code>
    instruction controls the CPU's rounding mode for floating-point math. In v1, it executed
    frequently - but changing the rounding mode is <strong>expensive</strong> on modern CPUs
    because it forces the processor to flush its instruction pipeline.
  </p>
  <p>
    In v2, <code>CFROUND</code> becomes <strong>conditional</strong>, executing only 1/16th of the
    time. This dramatically reduces pipeline flushes. On AMD Zen 1 CPUs, this single change
    yielded an <strong>8.4% hashrate increase</strong>, with 5&ndash;10% gains expected across
    AMD architectures.
  </p>

  <div class="diagram">
    <strong style="color: var(--accent);">Pipeline Flush Frequency</strong>
    <div style="margin:1.5rem auto; max-width:600px;">
      <!-- v1: frequent flushes -->
      <p style="color:var(--blue); font-weight:700; margin-bottom:0.4rem; text-align:left; font-size:0.9rem;">v1 - CFROUND fires often (every ~16 instructions):</p>
      <div style="display:flex; gap:1px; margin-bottom:0.4rem; height:28px;">
        <div style="flex:3; background:var(--blue); border-radius:3px 0 0 3px;"></div>
        <div style="flex:0.4; background:var(--red); display:flex; align-items:center; justify-content:center; font-size:0.6rem; font-weight:700;">FLUSH</div>
        <div style="flex:3; background:var(--blue);"></div>
        <div style="flex:0.4; background:var(--red); display:flex; align-items:center; justify-content:center; font-size:0.6rem; font-weight:700;">FLUSH</div>
        <div style="flex:3; background:var(--blue);"></div>
        <div style="flex:0.4; background:var(--red); display:flex; align-items:center; justify-content:center; font-size:0.6rem; font-weight:700;">FLUSH</div>
        <div style="flex:3; background:var(--blue);"></div>
        <div style="flex:0.4; background:var(--red); display:flex; align-items:center; justify-content:center; font-size:0.6rem; font-weight:700;">FLUSH</div>
        <div style="flex:3; background:var(--blue); border-radius:0 3px 3px 0;"></div>
      </div>
      <p style="color:#e84545; font-size:0.8rem; text-align:left; margin-bottom:1.2rem;">Each red bar = pipeline flush. CPU throws away in-progress work and restarts.</p>

      <!-- v2: rare flushes -->
      <p style="color:var(--green); font-weight:700; margin-bottom:0.4rem; text-align:left; font-size:0.9rem;">v2 - CFROUND conditional (1/16 chance):</p>
      <div style="display:flex; gap:1px; margin-bottom:0.4rem; height:28px;">
        <div style="flex:15; background:var(--green); border-radius:3px 0 0 3px;"></div>
        <div style="flex:0.4; background:var(--red); display:flex; align-items:center; justify-content:center; font-size:0.6rem; font-weight:700;">FLUSH</div>
        <div style="flex:15; background:var(--green); border-radius:0 3px 3px 0;"></div>
      </div>
      <p style="color:var(--green); font-size:0.8rem; text-align:left;">Rarely interrupted. The CPU's pipeline stays full almost all the time.</p>
    </div>
  </div>
</section>

<section>
  <h2>Real-World Benchmark Results</h2>
  <p>
    The total operations per hash tell the story: v1 performs <strong>4,456,448</strong> total ops
    (4.2M VM + 262K AES), while v2 performs <strong>6,815,744</strong> total ops
    (6.3M VM + 524K AES) - a <strong>52.9% increase</strong> in work per hash.
  </p>
  <p>
    Raw hashrate (hashes/second) may drop slightly on some CPUs, but the <em>work per joule</em>
    - the metric that actually matters - improves dramatically:
  </p>

  <table>
    <thead>
      <tr>
        <th>Processor</th>
        <th>Arch</th>
        <th>Hashrate Change</th>
        <th>Work/Joule Improvement</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Ryzen AI 9 365</td>
        <td>Zen 5</td>
        <td style="color:var(--green);">+9.2%</td>
        <td style="color:var(--green); font-weight:700;">+67.0%</td>
      </tr>
      <tr>
        <td>Ryzen AI 9 HX 370</td>
        <td>Zen 5</td>
        <td style="color:var(--green);">+8.0%</td>
        <td style="color:var(--green); font-weight:700;">+65.1%</td>
      </tr>
      <tr>
        <td>Ryzen 7 1700X</td>
        <td>Zen 1</td>
        <td style="color:var(--green);">+0.8%</td>
        <td style="color:var(--green); font-weight:700;">+54.1%</td>
      </tr>
      <tr>
        <td>Core i9-12900K</td>
        <td>Alder Lake</td>
        <td style="color:var(--red);">-3.9%</td>
        <td style="color:var(--green); font-weight:700;">+47.0%</td>
      </tr>
      <tr>
        <td>Ryzen 9 7945HX</td>
        <td>Zen 4</td>
        <td style="color:var(--red);">-5.1%</td>
        <td style="color:var(--green); font-weight:700;">+45.2%</td>
      </tr>
      <tr>
        <td>Ryzen 9 3950X</td>
        <td>Zen 2</td>
        <td style="color:var(--red);">-7.9%</td>
        <td style="color:var(--green); font-weight:700;">+40.9%</td>
      </tr>
      <tr>
        <td>Ryzen 5 8600G</td>
        <td>Zen 4</td>
        <td style="color:var(--red);">-8.5%</td>
        <td style="color:var(--green); font-weight:700;">+39.9%</td>
      </tr>
      <tr>
        <td>Ryzen 9 5950X</td>
        <td>Zen 3</td>
        <td style="color:var(--red);">-12.5%</td>
        <td style="color:var(--green); font-weight:700;">+38.2%</td>
      </tr>
      <tr>
        <td>Ryzen 7 3700X</td>
        <td>Zen 2</td>
        <td style="color:var(--red);">-14.7%</td>
        <td style="color:var(--green); font-weight:700;">+30.5%</td>
      </tr>
      <tr>
        <td>Core i7-8650U</td>
        <td>Kaby Lake-R</td>
        <td style="color:var(--red);">-22.7%</td>
        <td style="color:var(--green); font-weight:700;">+18.2%</td>
      </tr>
      <tr>
        <td>Core i7-6820HQ</td>
        <td>Skylake</td>
        <td style="color:var(--red);">-24.4%</td>
        <td style="color:var(--green); font-weight:700;">+15.6%</td>
      </tr>
    </tbody>
  </table>

  <div class="diagram">
    <strong style="color: var(--accent);">Work/Joule Improvement by CPU (VM+AES ops per Joule)</strong>
    <div style="margin:1.5rem auto; max-width:680px;">
      <div style="display:flex; align-items:center; gap:0.5rem; margin-bottom:0.4rem;">
        <span style="width:155px; text-align:right; font-size:0.75rem; color:#aaa; white-space:nowrap;">Ryzen AI 9 365 <span style="color:#555;">(Zen5)</span></span>
        <div style="flex:1; background:#2a2a4a; border-radius:5px; height:24px; overflow:hidden;">
          <div style="width:100%; height:100%; background:linear-gradient(90deg, var(--green), #2ecc71); border-radius:5px; display:flex; align-items:center; padding-left:8px; font-size:0.75rem; font-weight:700; color:#1a1a2e;">+67.0%</div>
        </div>
      </div>
      <div style="display:flex; align-items:center; gap:0.5rem; margin-bottom:0.4rem;">
        <span style="width:155px; text-align:right; font-size:0.75rem; color:#aaa; white-space:nowrap;">Ryzen AI 9 HX 370 <span style="color:#555;">(Zen5)</span></span>
        <div style="flex:1; background:#2a2a4a; border-radius:5px; height:24px; overflow:hidden;">
          <div style="width:97%; height:100%; background:linear-gradient(90deg, var(--green), #2ecc71); border-radius:5px; display:flex; align-items:center; padding-left:8px; font-size:0.75rem; font-weight:700; color:#1a1a2e;">+65.1%</div>
        </div>
      </div>
      <div style="display:flex; align-items:center; gap:0.5rem; margin-bottom:0.4rem;">
        <span style="width:155px; text-align:right; font-size:0.75rem; color:#aaa; white-space:nowrap;">Ryzen 7 1700X <span style="color:#555;">(Zen1)</span></span>
        <div style="flex:1; background:#2a2a4a; border-radius:5px; height:24px; overflow:hidden;">
          <div style="width:81%; height:100%; background:linear-gradient(90deg, var(--green), #2ecc71); border-radius:5px; display:flex; align-items:center; padding-left:8px; font-size:0.75rem; font-weight:700; color:#1a1a2e;">+54.1%</div>
        </div>
      </div>
      <div style="display:flex; align-items:center; gap:0.5rem; margin-bottom:0.4rem;">
        <span style="width:155px; text-align:right; font-size:0.75rem; color:#aaa; white-space:nowrap;">Core i9-12900K <span style="color:#555;">(Alder)</span></span>
        <div style="flex:1; background:#2a2a4a; border-radius:5px; height:24px; overflow:hidden;">
          <div style="width:70%; height:100%; background:linear-gradient(90deg, var(--green), #2ecc71); border-radius:5px; display:flex; align-items:center; padding-left:8px; font-size:0.75rem; font-weight:700; color:#1a1a2e;">+47.0%</div>
        </div>
      </div>
      <div style="display:flex; align-items:center; gap:0.5rem; margin-bottom:0.4rem;">
        <span style="width:155px; text-align:right; font-size:0.75rem; color:#aaa; white-space:nowrap;">Ryzen 9 7945HX <span style="color:#555;">(Zen4)</span></span>
        <div style="flex:1; background:#2a2a4a; border-radius:5px; height:24px; overflow:hidden;">
          <div style="width:67%; height:100%; background:linear-gradient(90deg, var(--green), #2ecc71); border-radius:5px; display:flex; align-items:center; padding-left:8px; font-size:0.75rem; font-weight:700; color:#1a1a2e;">+45.2%</div>
        </div>
      </div>
      <div style="display:flex; align-items:center; gap:0.5rem; margin-bottom:0.4rem;">
        <span style="width:155px; text-align:right; font-size:0.75rem; color:#aaa; white-space:nowrap;">Ryzen 9 3950X <span style="color:#555;">(Zen2)</span></span>
        <div style="flex:1; background:#2a2a4a; border-radius:5px; height:24px; overflow:hidden;">
          <div style="width:61%; height:100%; background:linear-gradient(90deg, var(--green), #2ecc71); border-radius:5px; display:flex; align-items:center; padding-left:8px; font-size:0.75rem; font-weight:700; color:#1a1a2e;">+40.9%</div>
        </div>
      </div>
      <div style="display:flex; align-items:center; gap:0.5rem; margin-bottom:0.4rem;">
        <span style="width:155px; text-align:right; font-size:0.75rem; color:#aaa; white-space:nowrap;">Ryzen 5 8600G <span style="color:#555;">(Zen4)</span></span>
        <div style="flex:1; background:#2a2a4a; border-radius:5px; height:24px; overflow:hidden;">
          <div style="width:60%; height:100%; background:linear-gradient(90deg, var(--green), #2ecc71); border-radius:5px; display:flex; align-items:center; padding-left:8px; font-size:0.75rem; font-weight:700; color:#1a1a2e;">+39.9%</div>
        </div>
      </div>
      <div style="display:flex; align-items:center; gap:0.5rem; margin-bottom:0.4rem;">
        <span style="width:155px; text-align:right; font-size:0.75rem; color:#aaa; white-space:nowrap;">Ryzen 9 5950X <span style="color:#555;">(Zen3)</span></span>
        <div style="flex:1; background:#2a2a4a; border-radius:5px; height:24px; overflow:hidden;">
          <div style="width:57%; height:100%; background:linear-gradient(90deg, var(--green), #2ecc71); border-radius:5px; display:flex; align-items:center; padding-left:8px; font-size:0.75rem; font-weight:700; color:#1a1a2e;">+38.2%</div>
        </div>
      </div>
      <div style="display:flex; align-items:center; gap:0.5rem; margin-bottom:0.4rem;">
        <span style="width:155px; text-align:right; font-size:0.75rem; color:#aaa; white-space:nowrap;">Ryzen 7 3700X <span style="color:#555;">(Zen2)</span></span>
        <div style="flex:1; background:#2a2a4a; border-radius:5px; height:24px; overflow:hidden;">
          <div style="width:46%; height:100%; background:linear-gradient(90deg, var(--green), #2ecc71); border-radius:5px; display:flex; align-items:center; padding-left:8px; font-size:0.75rem; font-weight:700; color:#1a1a2e;">+30.5%</div>
        </div>
      </div>
      <div style="display:flex; align-items:center; gap:0.5rem; margin-bottom:0.4rem;">
        <span style="width:155px; text-align:right; font-size:0.75rem; color:#aaa; white-space:nowrap;">Core i7-8650U <span style="color:#555;">(KBL-R)</span></span>
        <div style="flex:1; background:#2a2a4a; border-radius:5px; height:24px; overflow:hidden;">
          <div style="width:27%; height:100%; background:linear-gradient(90deg, var(--green), #2ecc71); border-radius:5px; display:flex; align-items:center; padding-left:8px; font-size:0.75rem; font-weight:700; color:#1a1a2e;">+18.2%</div>
        </div>
      </div>
      <div style="display:flex; align-items:center; gap:0.5rem;">
        <span style="width:155px; text-align:right; font-size:0.75rem; color:#aaa; white-space:nowrap;">Core i7-6820HQ <span style="color:#555;">(SKL)</span></span>
        <div style="flex:1; background:#2a2a4a; border-radius:5px; height:24px; overflow:hidden;">
          <div style="width:23%; height:100%; background:linear-gradient(90deg, var(--green), #2ecc71); border-radius:5px; display:flex; align-items:center; padding-left:8px; font-size:0.75rem; font-weight:700; color:#1a1a2e;">+15.6%</div>
        </div>
      </div>
    </div>
    <p style="color:#aaa; font-size:0.85rem; margin-top:0.8rem;">
      Every tested CPU shows a significant efficiency gain - newer architectures benefit the most.
    </p>
  </div>

  <div class="callout">
    <strong>Why "work per joule" matters more than hashrate:</strong> A hash in v2 proves 53% more
    computational work than a hash in v1. Even if your CPU produces fewer hashes per second, it's
    doing more <em>total work</em> - and doing it more efficiently per watt of power consumed.
    For miners, this means lower electricity bills for the same level of network security contribution.
  </div>
</section>

<section>
  <h2>The Bigger Picture: ASIC Resistance</h2>
  <p>
    All of these changes share a common theme: making it <strong>harder to build a shortcut</strong>.
  </p>
  <ul>
    <li>
      <strong>More instructions per program</strong> means a custom chip needs a more complex
      execution engine - closer to a full general-purpose CPU.
    </li>
    <li>
      <strong>AES in the main loop</strong> means any hardware must include AES circuitry
      tightly integrated with the VM, not just bolted on for initialization.
    </li>
    <li>
      <strong>Deeper prefetch</strong> means the algorithm is tuned for how real CPUs and real
      DRAM actually behave, giving no advantage to exotic memory architectures.
    </li>
    <li>
      <strong>Conditional CFROUND</strong> rewards CPUs with fast, flexible floating-point
      pipelines - exactly what general-purpose processors have and ASICs typically lack.
    </li>
  </ul>
  <p>
    The net effect: a CPU designed for everyday computing (browsing, compiling, gaming) is
    also the ideal machine for RandomX v2. No specialized hardware can do it significantly better.
  </p>

  <div class="diagram">
    <strong style="color: var(--accent);">Layers of ASIC Resistance in v2</strong>
    <div style="margin:1.5rem auto; max-width:500px;">
      <!-- Outermost layer -->
      <div style="border:2px solid var(--accent); border-radius:16px; padding:1rem; background:rgba(247,147,26,0.05);">
        <div style="text-align:center; font-size:0.85rem; font-weight:700; color:var(--accent); margin-bottom:0.6rem;">Conditional CFROUND (flexible FP pipeline required)</div>
        <!-- Layer 2 -->
        <div style="border:2px solid var(--green); border-radius:12px; padding:1rem; background:rgba(78,204,163,0.05);">
          <div style="text-align:center; font-size:0.85rem; font-weight:700; color:var(--green); margin-bottom:0.6rem;">Deeper Prefetch (real DRAM behavior required)</div>
          <!-- Layer 3 -->
          <div style="border:2px solid var(--blue); border-radius:10px; padding:1rem; background:rgba(52,152,219,0.05);">
            <div style="text-align:center; font-size:0.85rem; font-weight:700; color:var(--blue); margin-bottom:0.6rem;">AES in Main Loop (full AES engine in VM)</div>
            <!-- Core -->
            <div style="border:2px solid var(--light); border-radius:8px; padding:0.8rem; background:rgba(232,232,232,0.08); text-align:center;">
              <div style="font-size:0.85rem; font-weight:700; color:var(--light);">384-Instruction Programs</div>
              <div style="font-size:0.75rem; color:#aaa; margin-top:0.2rem;">Complex execution engine needed</div>
            </div>
          </div>
        </div>
      </div>
      <p style="color:#aaa; font-size:0.8rem; margin-top:1rem;">
        An ASIC must defeat <em>every</em> layer to gain an advantage.<br>
        Each layer pushes the design closer to a general-purpose CPU.
      </p>
    </div>
  </div>
</section>

<section>
  <h2>Sources &amp; Further Reading</h2>
  <ul>
    <li><a href="https://github.com/SChernykh/RandomX/blob/v2/doc/design_v2.md" style="color:var(--accent);">RandomX v2 Design Document</a> (authoritative specification and benchmark data)</li>
    <li><a href="https://github.com/tevador/RandomX/pull/274" style="color:var(--accent);">PR #274 - RandomX v2 Virtual Machine Changes</a> (tevador/RandomX)</li>
    <li><a href="https://gist.github.com/SChernykh/6058ecf01c929883b9d19c7eeadc8809" style="color:var(--accent);">RandomX v2 Testing Results</a> (SChernykh benchmark data)</li>
    <li><a href="https://github.com/tevador/RandomX/blob/master/doc/design.md" style="color:var(--accent);">RandomX Design Documentation</a> (latency hiding &amp; architecture)</li>
    <li><a href="https://github.com/SChernykh/RandomX/tree/v2" style="color:var(--accent);">SChernykh/RandomX</a> (v2 implementation repository)</li>
  </ul>
</section>

</div>

<footer>
  <p>RandomX v2 Benchmark Suite - <a href="https://github.com/SChernykh/RandomX/tree/v2" style="color:var(--accent);">github.com/SChernykh/RandomX (v2 branch)</a></p>
</footer>

</body>
</html>
